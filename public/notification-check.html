<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Android é€šçŸ¥è¯Šæ–­å·¥å…·</title>
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
      padding: 20px;
      background: #f5f5f5;
      line-height: 1.6;
    }
    .container { max-width: 600px; margin: 0 auto; }
    .card {
      background: white;
      border-radius: 12px;
      padding: 20px;
      margin-bottom: 20px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.1);
    }
    h1 { color: #333; margin-bottom: 10px; font-size: 24px; }
    h2 { color: #555; margin-bottom: 15px; font-size: 18px; }
    .status {
      padding: 12px;
      border-radius: 8px;
      margin-bottom: 10px;
      font-size: 14px;
    }
    .success { background: #d4edda; color: #155724; border: 1px solid #c3e6cb; }
    .error { background: #f8d7da; color: #721c24; border: 1px solid #f5c6cb; }
    .warning { background: #fff3cd; color: #856404; border: 1px solid #ffeaa7; }
    .info { background: #d1ecf1; color: #0c5460; border: 1px solid #bee5eb; }
    button {
      background: #007AFF;
      color: white;
      border: none;
      padding: 14px 24px;
      border-radius: 8px;
      font-size: 16px;
      cursor: pointer;
      width: 100%;
      margin-bottom: 10px;
      font-weight: 500;
    }
    button:active { opacity: 0.8; }
    button.secondary {
      background: #6c757d;
    }
    button.danger {
      background: #dc3545;
    }
    .log {
      background: #f8f9fa;
      border: 1px solid #dee2e6;
      border-radius: 8px;
      padding: 15px;
      max-height: 300px;
      overflow-y: auto;
      font-family: 'Courier New', monospace;
      font-size: 12px;
      white-space: pre-wrap;
      word-wrap: break-word;
    }
    .step {
      padding: 10px;
      margin-bottom: 10px;
      border-left: 3px solid #007AFF;
      background: #f8f9fa;
      border-radius: 4px;
    }
    .step-number {
      display: inline-block;
      width: 24px;
      height: 24px;
      background: #007AFF;
      color: white;
      border-radius: 50%;
      text-align: center;
      line-height: 24px;
      margin-right: 8px;
      font-weight: bold;
      font-size: 14px;
    }
  </style>
</head>
<body>
  <div class="container">
    <div class="card">
      <h1>ğŸ”” Android é€šçŸ¥è¯Šæ–­å·¥å…·</h1>
      <p style="color: #666; margin-bottom: 20px;">
        å¿«é€Ÿæ£€æŸ¥ Android è®¾å¤‡ä¸Šçš„é€šçŸ¥åŠŸèƒ½æ˜¯å¦æ­£å¸¸
      </p>
    </div>

    <div class="card">
      <h2>ğŸ“Š ç³»ç»ŸçŠ¶æ€</h2>
      <div id="status"></div>
    </div>

    <div class="card">
      <h2>ğŸ§ª å¿«é€Ÿæµ‹è¯•</h2>
      <button onclick="runFullTest()">ğŸš€ è¿è¡Œå®Œæ•´æµ‹è¯•</button>
      <button onclick="requestPermission()" class="secondary">1ï¸âƒ£ è¯·æ±‚é€šçŸ¥æƒé™</button>
      <button onclick="sendTestNotification()" class="secondary">2ï¸âƒ£ å‘é€æµ‹è¯•é€šçŸ¥</button>
      <button onclick="sendMultiple()" class="secondary">3ï¸âƒ£ å‘é€ 3 æ¡é€šçŸ¥</button>
      <button onclick="checkSettings()" class="secondary">4ï¸âƒ£ æ£€æŸ¥è®¾ç½®</button>
      <button onclick="clearLog()" class="danger">æ¸…ç©ºæ—¥å¿—</button>
    </div>

    <div class="card">
      <h2>ğŸ“ è¯Šæ–­æ—¥å¿—</h2>
      <div id="log" class="log">ç­‰å¾…æµ‹è¯•...</div>
    </div>

    <div class="card">
      <h2>ğŸ’¡ ä½¿ç”¨è¯´æ˜</h2>
      <div class="step">
        <span class="step-number">1</span>
        ç‚¹å‡»"è¿è¡Œå®Œæ•´æµ‹è¯•"è¿›è¡Œè‡ªåŠ¨è¯Šæ–­
      </div>
      <div class="step">
        <span class="step-number">2</span>
        å¦‚æœæƒé™æ˜¯ deniedï¼Œç‚¹å‡»"è¯·æ±‚é€šçŸ¥æƒé™"
      </div>
      <div class="step">
        <span class="step-number">3</span>
        æƒé™æˆäºˆåï¼Œç‚¹å‡»"å‘é€æµ‹è¯•é€šçŸ¥"
      </div>
      <div class="step">
        <span class="step-number">4</span>
        å¦‚æœè¿˜æ˜¯æ²¡æœ‰é€šçŸ¥ï¼ŒæŸ¥çœ‹ä¸‹æ–¹çš„è¯Šæ–­å»ºè®®
      </div>
    </div>

    <div class="card" id="suggestions" style="display: none;">
      <h2>ğŸ”§ è¯Šæ–­å»ºè®®</h2>
      <div id="suggestionContent"></div>
    </div>
  </div>

  <script>
    let testResults = {
      hasNotificationAPI: false,
      permission: 'unknown',
      canSendNotification: false,
      isAndroid: false,
      isChrome: false,
      errors: []
    };

    function log(message, type = 'info') {
      const logDiv = document.getElementById('log');
      const timestamp = new Date().toLocaleTimeString();
      const icon = type === 'error' ? 'âŒ' : type === 'success' ? 'âœ…' : type === 'warning' ? 'âš ï¸' : 'â„¹ï¸';
      logDiv.textContent += `[${timestamp}] ${icon} ${message}\n`;
      logDiv.scrollTop = logDiv.scrollHeight;
      console.log(`[${type}]`, message);
    }

    function clearLog() {
      document.getElementById('log').textContent = 'æ—¥å¿—å·²æ¸…ç©º\n';
      log('æ—¥å¿—å·²æ¸…ç©º');
    }

    function updateStatus() {
      const statusDiv = document.getElementById('status');
      const ua = navigator.userAgent;
      const isAndroid = /Android/i.test(ua);
      const isChrome = /Chrome/i.test(ua) && !/Edge/i.test(ua);
      const hasAPI = 'Notification' in window;
      const permission = hasAPI ? Notification.permission : 'N/A';

      testResults.isAndroid = isAndroid;
      testResults.isChrome = isChrome;
      testResults.hasNotificationAPI = hasAPI;
      testResults.permission = permission;

      let html = '';
      
      html += `<div class="status ${isAndroid ? 'success' : 'warning'}">
        <strong>å¹³å°:</strong> ${isAndroid ? 'âœ… Android' : 'âš ï¸ é Android'}
      </div>`;
      
      html += `<div class="status ${isChrome ? 'success' : 'warning'}">
        <strong>æµè§ˆå™¨:</strong> ${isChrome ? 'âœ… Chrome' : 'âš ï¸ é Chrome'}
      </div>`;
      
      html += `<div class="status ${hasAPI ? 'success' : 'error'}">
        <strong>Notification API:</strong> ${hasAPI ? 'âœ… æ”¯æŒ' : 'âŒ ä¸æ”¯æŒ'}
      </div>`;
      
      html += `<div class="status ${permission === 'granted' ? 'success' : permission === 'denied' ? 'error' : 'warning'}">
        <strong>é€šçŸ¥æƒé™:</strong> ${permission === 'granted' ? 'âœ… å·²æˆæƒ' : permission === 'denied' ? 'âŒ å·²æ‹’ç»' : 'âš ï¸ æœªè¯·æ±‚'}
      </div>`;

      statusDiv.innerHTML = html;
    }

    async function requestPermission() {
      log('å¼€å§‹è¯·æ±‚é€šçŸ¥æƒé™...');
      
      if (!('Notification' in window)) {
        log('æµè§ˆå™¨ä¸æ”¯æŒ Notification API', 'error');
        testResults.errors.push('æµè§ˆå™¨ä¸æ”¯æŒé€šçŸ¥');
        showSuggestions();
        return;
      }

      try {
        const permission = await Notification.requestPermission();
        log(`æƒé™è¯·æ±‚ç»“æœ: ${permission}`);
        testResults.permission = permission;
        
        if (permission === 'granted') {
          log('âœ… æƒé™å·²æˆäºˆï¼å¯ä»¥å‘é€é€šçŸ¥äº†', 'success');
        } else if (permission === 'denied') {
          log('âŒ æƒé™è¢«æ‹’ç»', 'error');
          testResults.errors.push('æƒé™è¢«æ‹’ç»');
          showSuggestions();
        } else {
          log('âš ï¸ æƒé™è¯·æ±‚è¢«å¿½ç•¥', 'warning');
        }
      } catch (error) {
        log(`æƒé™è¯·æ±‚å¤±è´¥: ${error.message}`, 'error');
        testResults.errors.push(`æƒé™è¯·æ±‚å¤±è´¥: ${error.message}`);
        showSuggestions();
      }
      
      updateStatus();
    }

    function sendTestNotification() {
      log('å‡†å¤‡å‘é€æµ‹è¯•é€šçŸ¥...');
      
      if (!('Notification' in window)) {
        log('æµè§ˆå™¨ä¸æ”¯æŒé€šçŸ¥', 'error');
        return;
      }

      if (Notification.permission !== 'granted') {
        log('æ²¡æœ‰é€šçŸ¥æƒé™ï¼Œè¯·å…ˆè¯·æ±‚æƒé™', 'error');
        return;
      }

      try {
        log('åˆ›å»ºé€šçŸ¥å¯¹è±¡...');
        const notification = new Notification('ğŸ‰ æµ‹è¯•æˆåŠŸï¼', {
          body: 'å¦‚æœä½ çœ‹åˆ°è¿™æ¡é€šçŸ¥ï¼Œè¯´æ˜åŠŸèƒ½æ­£å¸¸ï¼',
          icon: '/icon-192.png',
          badge: '/icon-192.png',
          tag: 'test',
          requireInteraction: false
        });

        notification.onshow = () => {
          log('âœ… é€šçŸ¥å·²æ˜¾ç¤ºï¼', 'success');
          testResults.canSendNotification = true;
        };

        notification.onclick = () => {
          log('é€šçŸ¥è¢«ç‚¹å‡»');
          window.focus();
          notification.close();
        };

        notification.onerror = (error) => {
          log(`é€šçŸ¥æ˜¾ç¤ºé”™è¯¯: ${error}`, 'error');
          testResults.errors.push(`é€šçŸ¥æ˜¾ç¤ºé”™è¯¯: ${error}`);
          showSuggestions();
        };

        log('é€šçŸ¥å¯¹è±¡å·²åˆ›å»ºï¼Œç­‰å¾…æ˜¾ç¤º...', 'success');
      } catch (error) {
        log(`å‘é€é€šçŸ¥å¤±è´¥: ${error.message}`, 'error');
        testResults.errors.push(`å‘é€å¤±è´¥: ${error.message}`);
        showSuggestions();
      }
    }

    function sendMultiple() {
      log('å¼€å§‹å‘é€ 3 æ¡é€šçŸ¥...');
      
      if (Notification.permission !== 'granted') {
        log('æ²¡æœ‰é€šçŸ¥æƒé™', 'error');
        return;
      }

      for (let i = 0; i < 3; i++) {
        setTimeout(() => {
          try {
            new Notification(`æµ‹è¯•é€šçŸ¥ ${i + 1}`, {
              body: `è¿™æ˜¯ç¬¬ ${i + 1} æ¡æµ‹è¯•é€šçŸ¥`,
              icon: '/icon-192.png',
              tag: `test-${i}`
            });
            log(`âœ… å·²å‘é€ç¬¬ ${i + 1} æ¡é€šçŸ¥`, 'success');
          } catch (error) {
            log(`âŒ ç¬¬ ${i + 1} æ¡é€šçŸ¥å‘é€å¤±è´¥: ${error.message}`, 'error');
          }
        }, i * 2000);
      }
    }

    function checkSettings() {
      log('=== ç³»ç»Ÿè®¾ç½®æ£€æŸ¥ ===');
      log(`User Agent: ${navigator.userAgent}`);
      log(`Platform: ${navigator.platform}`);
      log(`Language: ${navigator.language}`);
      log(`Online: ${navigator.onLine}`);
      log(`Notification API: ${'Notification' in window ? 'æ”¯æŒ' : 'ä¸æ”¯æŒ'}`);
      
      if ('Notification' in window) {
        log(`Permission: ${Notification.permission}`);
        log(`Max Actions: ${Notification.maxActions || 'N/A'}`);
      }

      if ('serviceWorker' in navigator) {
        navigator.serviceWorker.getRegistration().then(reg => {
          log(`Service Worker: ${reg ? 'å·²æ³¨å†Œ' : 'æœªæ³¨å†Œ'}`);
        });
      } else {
        log('Service Worker: ä¸æ”¯æŒ');
      }

      log('=== æ£€æŸ¥å®Œæˆ ===');
    }

    async function runFullTest() {
      log('=== å¼€å§‹å®Œæ•´æµ‹è¯• ===');
      clearLog();
      testResults.errors = [];
      
      // 1. æ£€æŸ¥ç¯å¢ƒ
      log('æ­¥éª¤ 1/4: æ£€æŸ¥ç¯å¢ƒ...');
      updateStatus();
      await new Promise(resolve => setTimeout(resolve, 500));
      
      // 2. æ£€æŸ¥æƒé™
      log('æ­¥éª¤ 2/4: æ£€æŸ¥æƒé™...');
      if (Notification.permission === 'default') {
        log('æƒé™æœªè¯·æ±‚ï¼Œæ­£åœ¨è¯·æ±‚...', 'warning');
        await requestPermission();
      } else if (Notification.permission === 'denied') {
        log('æƒé™å·²è¢«æ‹’ç»', 'error');
        testResults.errors.push('æƒé™è¢«æ‹’ç»');
      } else {
        log('æƒé™å·²æˆäºˆ', 'success');
      }
      await new Promise(resolve => setTimeout(resolve, 500));
      
      // 3. å‘é€æµ‹è¯•é€šçŸ¥
      log('æ­¥éª¤ 3/4: å‘é€æµ‹è¯•é€šçŸ¥...');
      if (Notification.permission === 'granted') {
        sendTestNotification();
      } else {
        log('è·³è¿‡ï¼ˆæ²¡æœ‰æƒé™ï¼‰', 'warning');
      }
      await new Promise(resolve => setTimeout(resolve, 1000));
      
      // 4. ç”ŸæˆæŠ¥å‘Š
      log('æ­¥éª¤ 4/4: ç”Ÿæˆè¯Šæ–­æŠ¥å‘Š...');
      generateReport();
      
      log('=== æµ‹è¯•å®Œæˆ ===');
    }

    function generateReport() {
      log('\n=== è¯Šæ–­æŠ¥å‘Š ===');
      log(`Android: ${testResults.isAndroid ? 'âœ…' : 'âŒ'}`);
      log(`Chrome: ${testResults.isChrome ? 'âœ…' : 'âŒ'}`);
      log(`Notification API: ${testResults.hasNotificationAPI ? 'âœ…' : 'âŒ'}`);
      log(`Permission: ${testResults.permission}`);
      log(`Can Send: ${testResults.canSendNotification ? 'âœ…' : 'âŒ'}`);
      
      if (testResults.errors.length > 0) {
        log('\nå‘ç°é—®é¢˜:');
        testResults.errors.forEach((error, index) => {
          log(`${index + 1}. ${error}`, 'error');
        });
        showSuggestions();
      } else if (testResults.canSendNotification) {
        log('\nâœ… æ‰€æœ‰æµ‹è¯•é€šè¿‡ï¼é€šçŸ¥åŠŸèƒ½æ­£å¸¸', 'success');
      }
      
      log('=== æŠ¥å‘Šç»“æŸ ===\n');
    }

    function showSuggestions() {
      const suggestionsDiv = document.getElementById('suggestions');
      const contentDiv = document.getElementById('suggestionContent');
      
      let html = '';
      
      if (!testResults.isAndroid) {
        html += `<div class="status warning">
          <strong>âš ï¸ é Android è®¾å¤‡</strong><br>
          æ­¤å·¥å…·ä¸“ä¸º Android è®¾è®¡ã€‚å¦‚æœä½ åœ¨å…¶ä»–å¹³å°ï¼Œè¯·ä½¿ç”¨å¯¹åº”çš„æµ‹è¯•å·¥å…·ã€‚
        </div>`;
      }
      
      if (!testResults.isChrome) {
        html += `<div class="status warning">
          <strong>âš ï¸ é Chrome æµè§ˆå™¨</strong><br>
          å»ºè®®ä½¿ç”¨ Chrome æµè§ˆå™¨ä»¥è·å¾—æœ€ä½³æ”¯æŒã€‚
        </div>`;
      }
      
      if (!testResults.hasNotificationAPI) {
        html += `<div class="status error">
          <strong>âŒ ä¸æ”¯æŒ Notification API</strong><br>
          ä½ çš„æµè§ˆå™¨ä¸æ”¯æŒé€šçŸ¥åŠŸèƒ½ã€‚è¯·æ›´æ–°æµè§ˆå™¨æˆ–ä½¿ç”¨ Chromeã€‚
        </div>`;
      }
      
      if (testResults.permission === 'denied') {
        html += `<div class="status error">
          <strong>âŒ é€šçŸ¥æƒé™è¢«æ‹’ç»</strong><br>
          è§£å†³æ–¹æ³•ï¼š<br>
          1. ç‚¹å‡»åœ°å€æ å·¦ä¾§çš„ ğŸ”’ å›¾æ ‡<br>
          2. æ‰¾åˆ°"é€šçŸ¥"æƒé™<br>
          3. æ”¹ä¸º"å…è®¸"<br>
          4. åˆ·æ–°é¡µé¢é‡æ–°æµ‹è¯•
        </div>`;
      }
      
      if (testResults.permission === 'granted' && !testResults.canSendNotification) {
        html += `<div class="status error">
          <strong>âŒ æœ‰æƒé™ä½†æ— æ³•å‘é€é€šçŸ¥</strong><br>
          å¯èƒ½çš„åŸå› ï¼š<br>
          1. ç³»ç»Ÿé€šçŸ¥è¢«ç¦ç”¨ï¼ˆè®¾ç½® â†’ é€šçŸ¥ï¼‰<br>
          2. Chrome é€šçŸ¥è¢«ç¦ç”¨ï¼ˆè®¾ç½® â†’ åº”ç”¨ â†’ Chrome â†’ é€šçŸ¥ï¼‰<br>
          3. å‹¿æ‰°æ¨¡å¼å·²å¼€å¯<br>
          4. ç”µæ± ä¼˜åŒ–é™åˆ¶äº†é€šçŸ¥
        </div>`;
      }
      
      if (html) {
        contentDiv.innerHTML = html;
        suggestionsDiv.style.display = 'block';
      }
    }

    // é¡µé¢åŠ è½½æ—¶æ›´æ–°çŠ¶æ€
    window.addEventListener('load', () => {
      log('=== Android é€šçŸ¥è¯Šæ–­å·¥å…·å·²åŠ è½½ ===');
      updateStatus();
      log('ç‚¹å‡»"è¿è¡Œå®Œæ•´æµ‹è¯•"å¼€å§‹è¯Šæ–­');
    });
  </script>
</body>
</html>
